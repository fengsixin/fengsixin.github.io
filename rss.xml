<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>fsx'blog</title><link>https://fsx.design/</link><description>Recent content on fsx'blog</description><generator>Hugo -- gohugo.io</generator><language>zh-CN</language><lastBuildDate>Fri, 04 Aug 2023 08:03:35 +0800</lastBuildDate><atom:link href="https://fsx.design/rss.xml" rel="self" type="application/rss+xml"/><item><title>合并广联达导出表08.xls的python代码</title><link>https://fsx.design/post/20230804-python/</link><pubDate>Fri, 04 Aug 2023 08:03:35 +0800</pubDate><guid>https://fsx.design/post/20230804-python/</guid><description>&lt;p>接到一个项目投标，招标人发出来的表格是广联达导出的excel表格。我一看，好家伙先分四个区域，然后每个区域又有无数个厂房，厂房文件夹下面才有这个区域的广联达表格。&lt;/p>
&lt;p>现在我的任务是需要对这些表格内的产品报价。挨个打开填固然是一种办法，但是很容易发生不同表格内的设备价格不一致问题。最好的办法就是先把表格合并，同一种设备的数量累加然后在总表中填写价格，这样就能避免价格不一致问题。&lt;/p>
&lt;p>下面是代码，我使用&lt;strong>chatgpt&lt;/strong>生成的，其实不需要懂编程，自己需要干啥告诉它就好：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> pandas &lt;span style="color:#66d9ef">as&lt;/span> pd
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> os
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 初始化一个空的DataFrame来存储所有的数据&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>all_data &lt;span style="color:#f92672">=&lt;/span> []
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#遍历D:\..\python\data\xt文件夹下的所有子文件夹，改成你的文件地址&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> root, dirs, files &lt;span style="color:#f92672">in&lt;/span> os&lt;span style="color:#f92672">.&lt;/span>walk(&lt;span style="color:#e6db74">&amp;#39;D:&lt;/span>&lt;span style="color:#ae81ff">\\&lt;/span>&lt;span style="color:#e6db74">fsx&lt;/span>&lt;span style="color:#ae81ff">\\&lt;/span>&lt;span style="color:#e6db74">python&lt;/span>&lt;span style="color:#ae81ff">\\&lt;/span>&lt;span style="color:#e6db74">data&lt;/span>&lt;span style="color:#ae81ff">\\&lt;/span>&lt;span style="color:#e6db74">xt&amp;#39;&lt;/span>):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span> file &lt;span style="color:#f92672">in&lt;/span> files:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#只处理Excel文件，并且跳过以~$开头的临时文件&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (file&lt;span style="color:#f92672">.&lt;/span>endswith(&lt;span style="color:#e6db74">&amp;#39;.xlsx&amp;#39;&lt;/span>) &lt;span style="color:#f92672">or&lt;/span> file&lt;span style="color:#f92672">.&lt;/span>endswith(&lt;span style="color:#e6db74">&amp;#39;.xls&amp;#39;&lt;/span>)) &lt;span style="color:#f92672">and&lt;/span> &lt;span style="color:#f92672">not&lt;/span> file&lt;span style="color:#f92672">.&lt;/span>startswith(&lt;span style="color:#e6db74">&amp;#39;~$&amp;#39;&lt;/span>):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 读取Excel文件&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> xls &lt;span style="color:#f92672">=&lt;/span> pd&lt;span style="color:#f92672">.&lt;/span>ExcelFile(os&lt;span style="color:#f92672">.&lt;/span>path&lt;span style="color:#f92672">.&lt;/span>join(root, file))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#检查文件是否有第二个标签页，我的文件表08在第二个标签页，按实际修改&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> len(xls&lt;span style="color:#f92672">.&lt;/span>sheet_names) &lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#读取第二个标签页（索引为1），并指定使用第三行作为列名&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> df &lt;span style="color:#f92672">=&lt;/span> pd&lt;span style="color:#f92672">.&lt;/span>read_excel(xls, sheet_name&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>, header&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#将数据添加到all_data中&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> all_data&lt;span style="color:#f92672">.&lt;/span>append(df)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#使用pd.concat合并所有的数据&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>all_data &lt;span style="color:#f92672">=&lt;/span> pd&lt;span style="color:#f92672">.&lt;/span>concat(all_data, ignore_index&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">True&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#按照项目名称和项目特征描述分组，然后对工程量进行求和&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>all_data[&lt;span style="color:#e6db74">&amp;#39;工程量&amp;#39;&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> all_data&lt;span style="color:#f92672">.&lt;/span>groupby([&lt;span style="color:#e6db74">&amp;#39;项目名称&amp;#39;&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;项目特征描述&amp;#39;&lt;/span>])[&lt;span style="color:#e6db74">&amp;#39;工程量&amp;#39;&lt;/span>]&lt;span style="color:#f92672">.&lt;/span>transform(&lt;span style="color:#e6db74">&amp;#39;sum&amp;#39;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#删除重复的行&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>all_data &lt;span style="color:#f92672">=&lt;/span> all_data&lt;span style="color:#f92672">.&lt;/span>drop_duplicates([&lt;span style="color:#e6db74">&amp;#39;项目名称&amp;#39;&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;项目特征描述&amp;#39;&lt;/span>])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#将结果保存到D:\fsx\python\data\xt\合并.xlsx文件中&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>all_data&lt;span style="color:#f92672">.&lt;/span>to_excel(&lt;span style="color:#e6db74">&amp;#39;D:&lt;/span>&lt;span style="color:#ae81ff">\\&lt;/span>&lt;span style="color:#e6db74">fsx&lt;/span>&lt;span style="color:#ae81ff">\\&lt;/span>&lt;span style="color:#e6db74">python&lt;/span>&lt;span style="color:#ae81ff">\\&lt;/span>&lt;span style="color:#e6db74">data&lt;/span>&lt;span style="color:#ae81ff">\\&lt;/span>&lt;span style="color:#e6db74">xt&lt;/span>&lt;span style="color:#ae81ff">\\&lt;/span>&lt;span style="color:#e6db74">合并.xlsx&amp;#39;&lt;/span>, index&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">False&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>完美，本来一天的工作，剩下7.5小时可以摸鱼了！&lt;/p></description></item><item><title>Helloworld</title><link>https://fsx.design/post/20230801-helloworld/</link><pubDate>Tue, 01 Aug 2023 11:55:46 +0800</pubDate><guid>https://fsx.design/post/20230801-helloworld/</guid><description>&lt;p>你好，世界！&lt;/p></description></item><item><title>关于fsx.design</title><link>https://fsx.design/about.html</link><pubDate>Thu, 09 Jun 2022 20:12:52 +0800</pubDate><guid>https://fsx.design/about.html</guid><description>Hi，我是冯思昕，这是我的个人blog。比较懒，想起来就写一下^_^ 愿景 40岁退休过上养老生活。</description></item></channel></rss>